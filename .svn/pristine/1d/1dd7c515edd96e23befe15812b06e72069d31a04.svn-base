
using Gmou.BusinessAccessLayer;
using Gmou.DomainModelEntities;
using Gmou.Web.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;

namespace Gmou.Web.Controllers
{
    public class AdminController : Controller
    {
        //
        // GET: /Admin/

        public ActionResult Index()
        {
            return View();
        }

        public ActionResult Index2()
        {
            return View();
        }

        public ActionResult employee()
        {
            return PartialView(@"~/Views\Admin\Partial\_getAllEmployee.cshtml");
        }

        
        public ActionResult ShowEmployee()
        {
            var lstEmployee = Gmou.BusinessAccessLayer.EmployeeBAL.GetAllEmployeelist();
           // ViewBag.empList = lstEmployee;
            return Json(lstEmployee,JsonRequestBehavior.AllowGet);
        }
      
       


        public ActionResult CreateEmployee()
        {
            Gmou.Web.Models.EmployeeViewModel employeemodel = new Models.EmployeeViewModel
            {
                lstDepartment = new SelectList(Gmou.BusinessAccessLayer.EmployeeBAL.GetDepartmentList(), "DepartmentID", "DepartmentName"),
                lstOffices = new SelectList(Gmou.BusinessAccessLayer.EmployeeBAL.GetOfficeList(), "OfficeAreaID", "OfficeAreaName")
            };
           
           
            return PartialView(@"~/Views\Admin\Partial\_createEmployee.cshtml",employeemodel);
        }

        public ActionResult EditEmployee(string empId)
        {
            ViewBag.empId = Encrypt.decryptMethod(empId);
            Gmou.Web.Models.EmployeeViewModel employeemodel = new Models.EmployeeViewModel
            {
                lstDepartment = new SelectList(Gmou.BusinessAccessLayer.EmployeeBAL.GetDepartmentList(), "DepartmentID", "DepartmentName"),
                lstOffices = new SelectList(Gmou.BusinessAccessLayer.EmployeeBAL.GetOfficeList(), "OfficeAreaID", "OfficeAreaName")
            };

            return PartialView(@"~/Views\Admin\Partial\_createEmployee.cshtml", employeemodel);
        }


        public ActionResult EditEmployeeDetail(string empId)
        {
            int id = Convert.ToInt32(empId);
            var employeeDetails = EmployeeBAL.EditEmployeeDetail(id);

            return Json(employeeDetails.ToList(), JsonRequestBehavior.AllowGet);
        }
       

        public ActionResult SearchEmployee(string empId)
        {
            ViewBag.empId = empId;
            return PartialView(@"~/Views\Admin\Partial\_searchEmployee.cshtml");
        }
        [HttpGet]
        public ActionResult GetEmployeeDetails(string employeeID)
        {
             int id = Convert.ToInt32(employeeID);
            var employeeDetails = EmployeeBAL.GetEmployeeDetail(id);

          return Json(employeeDetails.ToList(), JsonRequestBehavior.AllowGet);
        }
        [HttpPost]
        public ActionResult SaveEmpolyee(SaveEmployeeModel saveEmployeeModel)
        {
           // int employeeID = Convert.ToInt32(id);
          
            if (saveEmployeeModel.EmployeeId == 0)
            {
                saveEmployeeModel.Image = Session["Image"] as byte[];
                var result = BusinessAccessLayer.EmployeeBAL.SaveEmployeeDetails(Helpers.Converter.ConvertToDomainModel(saveEmployeeModel), false, 0);
                return Json(result, JsonRequestBehavior.AllowGet);
            }
            else
            {
                var result = BusinessAccessLayer.EmployeeBAL.SaveEmployeeDetails(Helpers.Converter.ConvertToDomainModel(saveEmployeeModel), true, saveEmployeeModel.EmployeeId);
                return Json(result, JsonRequestBehavior.AllowGet);
            }
        } 

      
        private void SaveImages(byte[] images)
        {

            System.IO.File.WriteAllBytes(@"C:\GMOUOnline\Gmou.Web\EmployeeEmages\demo.jpeg", images);
        }
        public ActionResult Upload()
        {
            
                return PartialView(@"~/Views\Admin\Partial\_uploadsingle.cshtml");
            

        }
        [HttpPost]
        public void Upload(HttpPostedFileBase uploadedFile)
        {
            if (uploadedFile != null && uploadedFile.ContentLength > 0)
            {
                byte[] FileByteArray = new byte[uploadedFile.ContentLength];
                uploadedFile.InputStream.Read(FileByteArray, 0, uploadedFile.ContentLength);
                Session["Image"] = FileByteArray;
              
            }
              
        }
    }
}
